"use strict";(self.webpackChunkreact_monkey_blogging_boilerplate=self.webpackChunkreact_monkey_blogging_boilerplate||[]).push([[299],{2299:function(e,t,n){n.r(t),n.d(t,{default:function(){return R}});var r=n(1413),a=n(5861),s=n(9439),i=n(7757),o=n.n(i),c=n(4167),u=n(5456),l=n(9501),d=n(9248),h=n(3031),p=n(3117),f=n(6848),m=n(4961),x=n(7823),g=n(9062),v=n(1776),b=n(8322),j=n(2791),k=n(1134),y=n(3504),Z=n(3585),w=n(6770),N=n.n(w),E=(n(6009),n(577)),I=n(8113),_=n(4569),D=n.n(_),S="https://api.imgbb.com/1/upload?key=".concat("cfe71e9e26a59994e591b6744b110c0f"),C=n(333),U=n.n(C),P=n(9808),A=n(1830),J=n.n(A),L=n(184);w.Quill.register("modules/imageUploader",I.Z);var R=function(){var e=(0,P.a)().userInfo,t=(0,y.lr)(),n=(0,s.Z)(t,1)[0].get("id"),i=(0,j.useState)(""),w=(0,s.Z)(i,2),I=w[0],_=w[1],C=(0,k.cI)({mode:"onChange"}),A=C.handleSubmit,R=C.control,T=C.setValue,Y=C.watch,F=C.reset,M=C.getValues,O=C.formState,V=O.isValid,Q=O.isSubmitting,q=M("image"),G=M("image_name"),z=(0,v.Z)(T,M,G,(function(){return $.apply(this,arguments)})),B=z.image,H=z.setImage,K=z.progress,W=z.handleSelectImage,X=z.handleDeleteImage;function $(){return($=(0,a.Z)(o().mark((function t(){var r;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((null===e||void 0===e?void 0:e.role)===Z.xZ.ADMIN){t.next=3;break}return J().fire("Failed","You have no right to do this action","warning"),t.abrupt("return");case 3:return r=(0,g.JU)(x.db,"users",n),t.next=6,(0,g.r7)(r,{avatar:""});case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}(0,j.useEffect)((function(){H(q)}),[q,H]);var ee=Y("hot"),te=Y("status");(0,j.useEffect)((function(){function e(){return(e=(0,a.Z)(o().mark((function e(){var t,r,a,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return");case 2:return t=(0,g.JU)(x.db,"posts",n),e.next=5,(0,g.QT)(t);case 5:(r=e.sent).data()&&(F(r.data()),se((null===(a=r.data())||void 0===a?void 0:a.category)||""),_((null===(s=r.data())||void 0===s?void 0:s.content)||""));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[n,F]);var ne=(0,j.useState)(""),re=(0,s.Z)(ne,2),ae=re[0],se=re[1],ie=(0,j.useState)([]),oe=(0,s.Z)(ie,2),ce=oe[0],ue=oe[1];(0,j.useEffect)((function(){function e(){return(e=(0,a.Z)(o().mark((function e(){var t,n,a,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,g.hJ)(x.db,"categories"),n=(0,g.IO)(t,(0,g.ar)("status","==",1)),e.next=4,(0,g.PL)(n);case 4:a=e.sent,s=[],a.forEach((function(e){s.push((0,r.Z)({id:e.id},e.data()))})),ue(s);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]);var le=function(){var e=(0,a.Z)(o().mark((function e(t){var n,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,g.JU)(x.db,"categories",t.id),e.next=3,(0,g.QT)(n);case 3:a=e.sent,T("category",(0,r.Z)({id:a.id},a.data())),se(t);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),de=function(){var t=(0,a.Z)(o().mark((function t(a){var s;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(V){t.next=2;break}return t.abrupt("return");case 2:if((null===e||void 0===e?void 0:e.role)===Z.xZ.ADMIN||(null===e||void 0===e?void 0:e.role)===Z.xZ.MOD||(null===e||void 0===e?void 0:e.role)===Z.xZ.USER){t.next=5;break}return J().fire("Failed","You have no right to do this action","warning"),t.abrupt("return");case 5:return s=(0,g.JU)(x.db,"posts",n),a.status=Number(a.status),a.slug=U()(a.slug||a.title,{lower:!0}),t.next=10,(0,g.r7)(s,(0,r.Z)((0,r.Z)({},a),{},{image:B,content:I}));case 10:E.Am.success("Update post successfully!");case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),he=(0,j.useMemo)((function(){return{toolbar:[["bold","italic","underline","strike"],["blockquote","code-block"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"},{align:[]}],[{header:[1,2,3,4,5,6,!1]}],["link","image","video"]],imageUploader:{upload:function(){var e=(0,a.Z)(o().mark((function e(t){var n,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new FormData).append("image",t),e.next=4,D()({method:"post",url:S,data:n,headers:{"Content-Type":"multipart/form-data"}});case 4:return r=e.sent,e.abrupt("return",r.data.data.url);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}}}),[]);return n?(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(b.Z,{title:"Update post",desc:"Update post content"}),(0,L.jsxs)("form",{onSubmit:A(de),children:[(0,L.jsxs)("div",{className:"form-layout",children:[(0,L.jsxs)(d.g,{children:[(0,L.jsx)(f._,{children:"Title"}),(0,L.jsx)(p.I,{control:R,placeholder:"Enter your title",name:"title",required:!0})]}),(0,L.jsxs)(d.g,{children:[(0,L.jsx)(f._,{children:"Slug"}),(0,L.jsx)(p.I,{control:R,placeholder:"Enter your slug",name:"slug"})]})]}),(0,L.jsxs)("div",{className:"form-layout",children:[(0,L.jsxs)(d.g,{children:[(0,L.jsx)(f._,{children:"Image"}),(0,L.jsx)(h.Z,{onChange:W,handleDeleteImage:X,className:"h-[250px]",progress:K,image:B})]}),(0,L.jsxs)(d.g,{children:[(0,L.jsx)(f._,{children:"Category"}),(0,L.jsxs)(l.L,{children:[(0,L.jsx)(l.L.Select,{placeholder:"Select the category"}),(0,L.jsx)(l.L.List,{children:ce.length>0&&ce.map((function(e){return(0,L.jsx)(l.L.Option,{onClick:function(){return le(e)},children:e.name},e.id)}))})]}),(null===ae||void 0===ae?void 0:ae.name)&&(0,L.jsx)("span",{className:"inline-block p-3 text-sm font-medium text-green-600 rounded-lg bg-green-50",children:null===ae||void 0===ae?void 0:ae.name})]})]}),(0,L.jsx)("div",{className:"mb-10",children:(0,L.jsxs)(d.g,{children:[(0,L.jsx)(f._,{children:"Content"}),(0,L.jsx)("div",{className:"w-full entry-content",children:(0,L.jsx)(N(),{modules:he,theme:"snow",value:I,onChange:_})})]})}),(0,L.jsxs)("div",{className:"form-layout",children:[(0,L.jsxs)(d.g,{children:[(0,L.jsx)(f._,{children:"Feature post"}),(0,L.jsx)(m.Z,{on:!0===ee,onClick:function(){return T("hot",!ee)}})]}),(0,L.jsxs)(d.g,{children:[(0,L.jsx)(f._,{children:"Status"}),(0,L.jsxs)(d.Y,{children:[(null===e||void 0===e?void 0:e.role)===Z.xZ.ADMIN&&(0,L.jsx)(u.Y,{name:"status",control:R,checked:Number(te)===Z.cf.APPROVED,value:Z.cf.APPROVED,children:"Approved"}),(0,L.jsx)(u.Y,{name:"status",control:R,checked:Number(te)===Z.cf.PENDING,value:Z.cf.PENDING,children:"Pending"}),(0,L.jsx)(u.Y,{name:"status",control:R,checked:Number(te)===Z.cf.REJECTED,value:Z.cf.REJECTED,children:"Reject"})]})]})]}),(0,L.jsx)(c.z,{type:"submit",className:"mx-auto w-[250px]",isLoading:Q,disabled:Q,children:"Update post"})]})]}):null}}}]);
//# sourceMappingURL=299.20b1529b.chunk.js.map