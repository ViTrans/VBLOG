"use strict";(self.webpackChunkreact_monkey_blogging_boilerplate=self.webpackChunkreact_monkey_blogging_boilerplate||[]).push([[472],{5472:function(e,t,n){n.r(t);var r=n(1413),s=n(5861),a=n(9439),c=n(7757),i=n.n(c),l=n(1776),o=n(4961),u=n(333),d=n.n(u),h=n(2791),f=n(3031),p=n(1134),x=n(9808),m=n(577),g=n(5456),v=n(3585),j=n(6848),b=n(3117),Z=n(9248),y=n(9501),k=n(7823),E=n(4167),w=n(9062),I=n(8322),N=n(1830),D=n.n(N),A=n(184);t.default=function(){var e=(0,x.a)().userInfo,t=(0,p.cI)({mode:"onChange",defaultValues:{title:"",slug:"",status:2,hot:!1,image:"",category:{},user:{}}}),n=t.control,c=t.watch,u=t.setValue,N=t.handleSubmit,_=t.getValues,S=t.reset,C=c("status"),L=c("hot"),P=(0,l.Z)(u,_),O=P.image,R=P.handleResetUpload,J=P.progress,V=P.handleSelectImage,G=P.handleDeleteImage,M=(0,h.useState)([]),T=(0,a.Z)(M,2),Y=T[0],F=T[1],U=(0,h.useState)(""),B=(0,a.Z)(U,2),q=B[0],z=B[1],Q=(0,h.useState)(!1),H=(0,a.Z)(Q,2),K=H[0],W=H[1];(0,h.useEffect)((function(){function t(){return(t=(0,s.Z)(i().mark((function t(){var n;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.email){t.next=2;break}return t.abrupt("return");case 2:return n=(0,w.IO)((0,w.hJ)(k.db,"users"),(0,w.ar)("email","==",e.email)),t.next=5,(0,w.PL)(n);case 5:t.sent.forEach((function(e){u("user",(0,r.Z)({id:e.id},e.data()))}));case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}!function(){t.apply(this,arguments)}()}),[e.email]);var X=function(){var t=(0,s.Z)(i().mark((function t(n){var s,a;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((null===e||void 0===e?void 0:e.role)===v.xZ.ADMIN||(null===e||void 0===e?void 0:e.role)===v.xZ.MOD||(null===e||void 0===e?void 0:e.role)===v.xZ.USER){t.next=3;break}return D().fire("Failed","You have no right to do this action","warning"),t.abrupt("return");case 3:return W(!0),t.prev=4,(s=(0,r.Z)({},n)).slug=d()(n.slug||n.title,{lower:!0}),s.status=Number(n.status),a=(0,w.hJ)(k.db,"posts"),t.next=11,(0,w.ET)(a,(0,r.Z)((0,r.Z)({},s),{},{categoryId:s.category.id,userId:s.user.id,image:O,createdAt:(0,w.Bt)()}));case 11:m.Am.success("Create new post successfully!"),S({title:"",slug:"",status:2,category:{},hot:!1,image:"",user:{}}),R(),z({}),t.next=20;break;case 17:t.prev=17,t.t0=t.catch(4),W(!1);case 20:return t.prev=20,W(!1),t.finish(20);case 23:case"end":return t.stop()}}),t,null,[[4,17,20,23]])})));return function(e){return t.apply(this,arguments)}}();(0,h.useEffect)((function(){function e(){return(e=(0,s.Z)(i().mark((function e(){var t,n,s,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,w.hJ)(k.db,"categories"),n=(0,w.IO)(t,(0,w.ar)("status","==",1)),e.next=4,(0,w.PL)(n);case 4:s=e.sent,a=[],s.forEach((function(e){a.push((0,r.Z)({id:e.id},e.data()))})),F(a);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]),(0,h.useEffect)((function(){document.title="VBLOGGING | Add new post"}),[]);var $=function(){var e=(0,s.Z)(i().mark((function e(t){var n,s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,w.JU)(k.db,"categories",t.id),e.next=3,(0,w.QT)(n);case 3:s=e.sent,u("category",(0,r.Z)({id:s.id},s.data())),z(t);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return e.role!==v.xZ.ADMIN&&e.role!==v.xZ.MOD?null:(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(I.Z,{title:"Add post",desc:"Add new post"}),(0,A.jsxs)("form",{onSubmit:N(X),children:[(0,A.jsxs)("div",{className:"form-layout",children:[(0,A.jsxs)(Z.g,{children:[(0,A.jsx)(j._,{children:"Title"}),(0,A.jsx)(b.I,{control:n,placeholder:"Enter your title",name:"title",required:!0})]}),(0,A.jsxs)(Z.g,{children:[(0,A.jsx)(j._,{children:"Slug"}),(0,A.jsx)(b.I,{control:n,placeholder:"Enter your slug",name:"slug"})]})]}),(0,A.jsxs)("div",{className:"form-layout",children:[(0,A.jsxs)(Z.g,{children:[(0,A.jsx)(j._,{children:"Image"}),(0,A.jsx)(f.Z,{onChange:V,handleDeleteImage:G,className:"h-[250px]",progress:J,image:O})]}),(0,A.jsxs)(Z.g,{children:[(0,A.jsx)(j._,{children:"Category"}),(0,A.jsxs)(y.L,{children:[(0,A.jsx)(y.L.Select,{placeholder:"Select the category"}),(0,A.jsx)(y.L.List,{children:Y.length>0&&Y.map((function(e){return(0,A.jsx)(y.L.Option,{onClick:function(){return $(e)},children:e.name},e.id)}))})]}),(null===q||void 0===q?void 0:q.name)&&(0,A.jsx)("span",{className:"inline-block p-3 text-sm font-medium text-green-600 rounded-lg bg-green-50",children:null===q||void 0===q?void 0:q.name})]})]}),(0,A.jsxs)("div",{className:"form-layout",children:[(0,A.jsxs)(Z.g,{children:[(0,A.jsx)(j._,{children:"Feature post"}),(0,A.jsx)(o.Z,{on:!0===L,onClick:function(){return u("hot",!L)}})]}),(0,A.jsxs)(Z.g,{children:[(0,A.jsx)(j._,{children:"Status"}),(0,A.jsxs)(Z.Y,{children:[(null===e||void 0===e?void 0:e.role)===v.xZ.ADMIN&&(0,A.jsx)(g.Y,{name:"status",control:n,checked:Number(C)===v.cf.APPROVED,value:v.cf.APPROVED,children:"Approved"}),(0,A.jsx)(g.Y,{name:"status",control:n,checked:Number(C)===v.cf.PENDING,value:v.cf.PENDING,children:"Pending"}),(0,A.jsx)(g.Y,{name:"status",control:n,checked:Number(C)===v.cf.REJECTED,value:v.cf.REJECTED,children:"Reject"})]})]})]}),(0,A.jsx)(E.z,{type:"submit",className:"mx-auto w-[250px]",isLoading:K,disabled:K,children:"Add new post"})]})]})}}}]);
//# sourceMappingURL=472.697b04dc.chunk.js.map